<div class="orderType" style="text-align:right;">
<% if @platform == "naver"%>
<%= link_to "인기순".html_safe, "/casein/apps?platform=naver&orderType=POPULARITY" %> / <%= link_to "설치 많은순".html_safe, "/casein/apps?platform=naver&orderType=INSTALL" %>
<% else %>
<%= link_to "최근 7일순".html_safe, "/casein/apps?platform=nate&orderType=1" %> / <%= link_to "전체 누적순".html_safe, "/casein/apps?platform=nate&orderType=2" %>
<% end %>
</div>
<br/>
<div class="graph">
	<div id="placeholder" style="width:100%;height:500px"></div>
</div>

<script type="text/javascript">
  var graphData = <%= raw @graphData.to_json %>;
  var graphOptions = <%= raw @graphOptions.to_json %>;
  $.plot($("#placeholder"), graphData, graphOptions);

  function showTooltip(x, y, contents) {
      $('<div id="tooltip">' + contents + '</div>').css( {
          position: 'absolute',
          display: 'none',
          top: y + 5,
          left: x + 5,
          border: '1px solid #fdd',
          padding: '2px',
          'background-color': '#fee',
          opacity: 0.80
      }).appendTo("body").fadeIn(200);
  }

  var previousPoint = null;
  $("#placeholder").bind("plothover", function (event, pos, item) {
      $("#x").text(pos.x.toFixed(2));
      $("#y").text(pos.y.toFixed(2));

      if (item) {
          if (previousPoint != item.dataIndex) {
              previousPoint = item.dataIndex;
              
              $("#tooltip").remove();
              var x = item.datapoint[0].toFixed(2),
                  y = item.datapoint[1].toFixed(2);
              
              showTooltip(item.pageX, item.pageY,
                          item.series.label + " : " + $.plot.formatDate(new Date(item.datapoint[0]), "%y/%m/%d", null) + " - " + item.datapoint[1] + "위");
          }
      }
      else {
          $("#tooltip").remove();
          previousPoint = null;            
      }

  });
</script>

<!-- Scaffolding generated by Casein v.3.1.7 -->

<h2>Apps</h2>
<%= render :partial => 'casein/apps/table', :locals => { :apps => @apps } %>

<%= will_paginate @apps %>

<%= content_for :sidebar do %>
	<!-- <li><%= link_to "#{casein_show_icon "add"}Add a new app".html_safe, new_casein_app_path %></li> -->
<% end %>